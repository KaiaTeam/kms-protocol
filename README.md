# Kaia Native USDT ë¨¸ë‹ˆ ìŠ¤íŠ¸ë¦¬ë° ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸

## ê°œìš”

Kaia ë¸”ë¡ì²´ì¸ ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ ìê¸ˆ ìŠ¤íŠ¸ë¦¬ë° í”„ë¡œí† ì½œì…ë‹ˆë‹¤. USDT(Tether)ë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ ê²°ì œ ì‹œìŠ¤í…œìœ¼ë¡œ, ë§¤ì´ˆë§ˆë‹¤ ì„¤ì •ëœ ë¹„ìœ¨ë¡œ ìê¸ˆì´ í˜ëŸ¬ê°€ëŠ” í˜ì‹ ì ì¸ DeFi ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### ğŸŒŠ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°
- **ì—°ì†ì  ê²°ì œ**: ë§¤ì´ˆë§ˆë‹¤ ì„¤ì •ëœ flow rateì— ë”°ë¼ ìê¸ˆì´ í˜ëŸ¬ê°
  - *ì™œ í•„ìš”í•œê°€?* ì›”ê¸‰, êµ¬ë…ë£Œ, í”„ë¡œì íŠ¸ ê³„ì•½ê¸ˆ ë“±ì„ ì •í™•í•œ ì‹œì ì— ë§ì¶° ì§€ê¸‰í•˜ì—¬ í˜„ê¸ˆ íë¦„ì„ ìµœì í™”
- **ì‹¤ì‹œê°„ ì •ì‚°**: ë¸”ë¡ì²´ì¸ ê¸°ë°˜ì˜ íˆ¬ëª…í•˜ê³  ìë™í™”ëœ ì •ì‚° ì‹œìŠ¤í…œ
  - *ì™œ í•„ìš”í•œê°€?* ì¤‘ê°„ ì—…ì²´ ì—†ì´ ì§ì ‘ ì •ì‚°í•˜ì—¬ ìˆ˜ìˆ˜ë£Œ ì ˆì•½ ë° ë¶„ìŸ ë°©ì§€
- **ì¦‰ì‹œ ì¶œê¸ˆ**: ìˆ˜ë ¹ìëŠ” ì–¸ì œë“ ì§€ í˜„ì¬ê¹Œì§€ ìŒ“ì¸ ê¸ˆì•¡ì„ ì¶œê¸ˆ ê°€ëŠ¥
  - *ì™œ í•„ìš”í•œê°€?* ê¸‰ì—¬ì¼ì„ ê¸°ë‹¤ë¦´ í•„ìš” ì—†ì´ ì¼í•œ ë§Œí¼ ì¦‰ì‹œ í˜„ê¸ˆí™” ê°€ëŠ¥

### ğŸ’° USDT íŠ¹í™” ì§€ì›
- **6ìë¦¬ ì†Œìˆ˜ì **: USDTì˜ 6-decimal êµ¬ì¡°ì— ìµœì í™”
  - *ì™œ í•„ìš”í•œê°€?* ë‹¬ëŸ¬ ê¸°ì¤€ ì •í™•í•œ ê¸ˆì•¡ ê³„ì‚°ìœ¼ë¡œ í™˜ìœ¨ ë³€ë™ ìœ„í—˜ ì œê±°
- **ì§ê´€ì  ì¸í„°í˜ì´ìŠ¤**: ë‹¬ëŸ¬ ë‹¨ìœ„ë¡œ ì§ì ‘ ì…ë ¥ (ë³µì¡í•œ wei ê³„ì‚° ë¶ˆí•„ìš”)
  - *ì™œ í•„ìš”í•œê°€?* ì¼ë°˜ ì‚¬ìš©ìë„ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¹œí™”ì  ì¸í„°í˜ì´ìŠ¤ ì œê³µ

### ğŸ¯ ìŠ¤ë§ˆíŠ¸ ì œì–´
- **ì¼ì‹œì •ì§€/ì¬ê°œ**: ì†¡ê¸ˆìê°€ ìŠ¤íŠ¸ë¦¼ì„ ì–¸ì œë“  ì œì–´ ê°€ëŠ¥
  - *ì™œ í•„ìš”í•œê°€?* í”„ë¡œì íŠ¸ ì§€ì—°, ì„±ê³¼ ë¯¸ë‹¬ ë“±ì˜ ìƒí™©ì—ì„œ ìœ ì—°í•œ ëŒ€ì‘ ê°€ëŠ¥
- **ì•ˆì „í•œ ì·¨ì†Œ**: ìŠ¤íŠ¸ë¦¼ ì·¨ì†Œ ì‹œ ê³µì •í•œ ì”ì•¡ ë¶„ë°°
  - *ì™œ í•„ìš”í•œê°€?* ê³„ì•½ íŒŒê¸° ì‹œì—ë„ ì´ë¯¸ ìˆ˜í–‰ëœ ì‘ì—…ì— ëŒ€í•œ ì •ë‹¹í•œ ë³´ìƒ ë³´ì¥
- **ê¶Œí•œ ê´€ë¦¬**: ì†¡ê¸ˆìì™€ ìˆ˜ë ¹ìì˜ ì—­í•  ë¶„ë¦¬
  - *ì™œ í•„ìš”í•œê°€?* ë¬´ë‹¨ ì¡°ì‘ ë°©ì§€ ë° ê° ë‹¹ì‚¬ìì˜ ê¶Œë¦¬ ë³´í˜¸

### ğŸ›¡ï¸ ë³´ì•ˆ ë° ì‹ ë¢°ì„±
- **ì¬ì§„ì… ê³µê²© ë°©ì§€**: ReentrancyGuardë¡œ ë³´ì•ˆ ê°•í™”
  - *ì™œ í•„ìš”í•œê°€?* í•´ì»¤ì˜ ì•…ì˜ì  ê³µê²©ìœ¼ë¡œë¶€í„° ì‚¬ìš©ì ìê¸ˆ ë³´í˜¸
- **ì†Œìœ ê¶Œ ê´€ë¦¬**: Ownable íŒ¨í„´ìœ¼ë¡œ ê´€ë¦¬ì ê¸°ëŠ¥ ë³´í˜¸
  - *ì™œ í•„ìš”í•œê°€?* í”Œë«í¼ ì„¤ì • ë³€ê²½ì„ ìŠ¹ì¸ëœ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ
- **ì…ë ¥ê°’ ê²€ì¦**: ëª¨ë“  íŒŒë¼ë¯¸í„°ì˜ ì—„ê²©í•œ ìœ íš¨ì„± ê²€ì‚¬
  - *ì™œ í•„ìš”í•œê°€?* ì˜ëª»ëœ ë°ì´í„°ë¡œ ì¸í•œ ì˜¤ì‘ë™ ë° ìê¸ˆ ì†ì‹¤ ë°©ì§€

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
contracts/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ MoneyStreaming.sol      # ë©”ì¸ ì»¨íŠ¸ë™íŠ¸
â”‚   â””â”€â”€ mocks/
â”‚       â””â”€â”€ USDTMock.sol        # USDT í…ŒìŠ¤íŠ¸ í† í°
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ MoneyStreaming.t.sol    # ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ MoneyStreamingUSDT.t.sol # USDT íŠ¹í™” í…ŒìŠ¤íŠ¸
â”œâ”€â”€ script/
â”‚   â””â”€â”€ DeployMoneyStreaming.s.sol # ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ foundry.toml                # Foundry ì„¤ì •
â””â”€â”€ README.md                   # ì´ ë¬¸ì„œ
```

### USDTMock í…ŒìŠ¤íŠ¸ í† í°
*ì™œ USDTMockì´ í•„ìš”í•œê°€?* ì‹¤ì œ USDT í† í° ì—†ì´ë„ ë¡œì»¬/í…ŒìŠ¤íŠ¸ë„·ì—ì„œ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ì„ ì™„ì „íˆ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë„ë¡ ì§€ì›

#### ì£¼ìš” íŠ¹ì§•
- **6 decimals**: ì‹¤ì œ USDTì™€ ë™ì¼í•œ ì†Œìˆ˜ì  ìë¦¬ìˆ˜
- **Mint/Burn**: í…ŒìŠ¤íŠ¸ìš© í† í° ë°œí–‰ ë° ì†Œê° ê¸°ëŠ¥
- **ë³€í™˜ í•¨ìˆ˜**: ë‹¬ëŸ¬ â†” wei ë‹¨ìœ„ ê°„í¸ ë³€í™˜

## ì„¤ì¹˜ ë° ì„¤ì •

### í•„ìš” ì¡°ê±´
- [Foundry](https://book.getfoundry.sh/getting-started/installation)
- [Git](https://git-scm.com/)

### ì„¤ì¹˜
```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
forge install

# ì»´íŒŒì¼
forge build

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
forge test

# ê°€ìŠ¤ ë¦¬í¬íŠ¸ì™€ í•¨ê»˜ í…ŒìŠ¤íŠ¸
forge test --gas-report
```

### USDTMock ì‚¬ìš©ë²• (í…ŒìŠ¤íŠ¸/ê°œë°œìš©)

#### 1. USDTMock ë°°í¬
```solidity
// Foundry ìŠ¤í¬ë¦½íŠ¸ì—ì„œ
USDTMock usdtMock = new USDTMock();
```

#### 2. í…ŒìŠ¤íŠ¸ìš© USDT ë°œí–‰
```solidity
// í…ŒìŠ¤íŠ¸ ê³„ì •ì— 1000 USDT ë°œí–‰
usdtMock.mint(testAccount, usdtMock.toUSDT(1000)); // 1000 ë‹¬ëŸ¬ = 1,000,000,000 wei
```

#### 3. í¸ì˜ í•¨ìˆ˜ í™œìš©
```solidity
// ë‹¬ëŸ¬ â†’ wei ë³€í™˜
uint256 weiAmount = usdtMock.toUSDT(500);    // $500 â†’ 500,000,000 wei

// wei â†’ ë‹¬ëŸ¬ ë³€í™˜  
uint256 dollarAmount = usdtMock.fromUSDT(500000000); // 500,000,000 wei â†’ $500
```

#### 4. ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸ ì˜ˆì œ
```javascript
// JavaScript í…ŒìŠ¤íŠ¸ì—ì„œ
const usdtMock = await USDTMock.deploy();
await usdtMock.mint(sender.address, ethers.utils.parseUnits("10000", 6)); // $10,000 ë°œí–‰

// ìŠ¤íŠ¸ë¦¼ ìƒì„± í…ŒìŠ¤íŠ¸
await usdtMock.connect(sender).approve(moneyStreaming.address, ethers.utils.parseUnits("1000", 6));
const streamId = await moneyStreaming.connect(sender).createStreamUSDT(
    receiver.address,
    usdtMock.address,
    1000,           // $1000
    30 * 24 * 3600  // 30ì¼
);
```

## ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì‚¬ìš©ë²•

### 1. USDT ìŠ¤íŠ¸ë¦¼ ìƒì„± (ê¶Œì¥)
*ì™œ USDTë¥¼ ì‚¬ìš©í•˜ë‚˜?* ê°€ê²© ì•ˆì •ì„±ê³¼ ë‹¬ëŸ¬ ê¸°ì¤€ ì§ê´€ì  ê³„ì‚°ìœ¼ë¡œ ê¸‰ì—¬, ê³„ì•½ê¸ˆ ì§€ê¸‰ì— ìµœì í™”

#### ê°„ë‹¨í•œ ë°©ë²• - createStreamUSDT
*ì™œ ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë‚˜?* ë³µì¡í•œ ì‹œê°„ ê³„ì‚° ì—†ì´ ê¸°ê°„ë§Œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì‹œì‘/ì¢…ë£Œ ì‹œê°„ ì„¤ì •
```solidity
function createStreamUSDT(
    address receiver,         // ìˆ˜ë ¹ì ì£¼ì†Œ (0x0 ë¶ˆê°€)
    address usdtToken,       // USDT í† í° ì£¼ì†Œ (6 decimals í•„ìˆ˜)
    uint256 totalUSDTAmount, // USDT ê¸ˆì•¡ (ì˜ˆ: 1000 = $1000, decimals ì œì™¸í•œ ìˆœìˆ˜ ë‹¬ëŸ¬ê°’)
    uint256 durationInSeconds // ìŠ¤íŠ¸ë¦¼ ì§€ì† ì‹œê°„ (ì´ˆ ë‹¨ìœ„, ìµœì†Œ 1ì´ˆ)
) external returns (uint256 streamId)
```
**ì£¼ì˜ì‚¬í•­:**
- `totalUSDTAmount`ëŠ” decimalsë¥¼ ì œì™¸í•œ ë‹¬ëŸ¬ ë‹¨ìœ„ (1000 = $1000)
- ë‚´ë¶€ì ìœ¼ë¡œ `totalUSDTAmount * 10^6`ìœ¼ë¡œ ë³€í™˜ë¨
- `startTime`ì€ `block.timestamp`ë¡œ ìë™ ì„¤ì •

#### ì‹œê°„ ì§€ì • ë°©ë²• - createStreamUSDTWithDetails
*ì™œ ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë‚˜?* íŠ¹ì • ë‚ ì§œì— ì‹œì‘/ì¢…ë£Œí•´ì•¼ í•˜ëŠ” í”„ë¡œì íŠ¸ë‚˜ ê³„ì•½ì— í™œìš©
```solidity
function createStreamUSDTWithDetails(
    address receiver,         // ìˆ˜ë ¹ì ì£¼ì†Œ (0x0 ë¶ˆê°€)
    address usdtToken,       // USDT í† í° ì£¼ì†Œ (6 decimals í•„ìˆ˜)  
    uint256 totalUSDTAmount, // USDT ê¸ˆì•¡ (ì˜ˆ: 1000 = $1000, decimals ì œì™¸í•œ ìˆœìˆ˜ ë‹¬ëŸ¬ê°’)
    uint256 startTime,       // ìŠ¤íŠ¸ë¦¼ ì‹œì‘ ì‹œê° (Unix timestamp, í˜„ì¬ì‹œê°„ ì´í›„)
    uint256 stopTime         // ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ ì‹œê° (Unix timestamp, startTime ì´í›„)
) external returns (uint256 streamId)
```
**ì£¼ì˜ì‚¬í•­:**
- `startTime`ê³¼ `stopTime`ì€ Unix timestamp (ì´ˆ ë‹¨ìœ„)
- `startTime >= block.timestamp` ì´ì–´ì•¼ í•¨
- `stopTime > startTime` ì´ì–´ì•¼ í•¨

### 2. ì”ì•¡ ì¡°íšŒ
*ì™œ ì”ì•¡ ì¡°íšŒê°€ ì¤‘ìš”í•œê°€?* ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œê¸ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡ì„ í™•ì¸í•˜ì—¬ í˜„ê¸ˆ íë¦„ ê´€ë¦¬

#### USDT ì”ì•¡ ì¡°íšŒ (ë‹¬ëŸ¬ ë‹¨ìœ„)
*ì™œ ë‹¬ëŸ¬ ë‹¨ìœ„ë¡œ ì¡°íšŒí•˜ë‚˜?* ë³µì¡í•œ wei ê³„ì‚° ì—†ì´ ì§ê´€ì ì¸ ë‹¬ëŸ¬ ê¸ˆì•¡ìœ¼ë¡œ í™•ì¸ ê°€ëŠ¥
```solidity
function getUSDTBalance(uint256 streamId, address account) 
    external view returns (uint256 balance)
```
**ì„¤ëª…:**
- ë°˜í™˜ê°’ì€ ë‹¬ëŸ¬ ë‹¨ìœ„ (decimals ì œì™¸)
- `account`ê°€ `receiver`ì¸ ê²½ìš°: í˜„ì¬ê¹Œì§€ ìŠ¤íŠ¸ë¦¬ë°ëœ ì¶œê¸ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡
- `account`ê°€ `sender`ì¸ ê²½ìš°: ì•„ì§ ìŠ¤íŠ¸ë¦¬ë°ë˜ì§€ ì•Šì€ ì”ì—¬ ê¸ˆì•¡
- ìŠ¤íŠ¸ë¦¼ì´ ì‹œì‘ë˜ì§€ ì•Šì•˜ìœ¼ë©´ receiverëŠ” 0 ë°˜í™˜

#### ì¼ë°˜ í† í° ì”ì•¡ ì¡°íšŒ (wei ë‹¨ìœ„)  
*ì™œ wei ë‹¨ìœ„ë„ í•„ìš”í•œê°€?* USDT ì™¸ ë‹¤ë¥¸ í† í°ì´ë‚˜ ì •ë°€í•œ ê³„ì‚°ì´ í•„ìš”í•œ ê°œë°œììš©
```solidity
function balanceOf(uint256 streamId, address account) 
    public view returns (uint256 balance)
```
**ì„¤ëª…:**
- ë°˜í™˜ê°’ì€ wei ë‹¨ìœ„ (USDTì˜ ê²½ìš° 10^6 ë‹¨ìœ„)
- ëª¨ë“  ERC20 í† í°ì—ì„œ ì‚¬ìš© ê°€ëŠ¥
- ë‚´ë¶€ ê³„ì‚° ë¡œì§:
  ```solidity
  uint256 elapsed = _calculateElapsedTime(streamId);
  uint256 streamed = elapsed * stream.flowRate;
  ```

#### USDT ìŠ¤íŠ¸ë¦¼ ìƒì„¸ ì •ë³´ ì¡°íšŒ
```solidity
function getUSDTStreamInfo(uint256 streamId) external view returns (
    address sender,           // ì†¡ê¸ˆì ì£¼ì†Œ
    address receiver,         // ìˆ˜ë ¹ì ì£¼ì†Œ
    address token,            // USDT í† í° ì£¼ì†Œ
    uint256 totalUSDTAmount,  // ì´ ìŠ¤íŠ¸ë¦¬ë° ê¸ˆì•¡ (ë‹¬ëŸ¬ ë‹¨ìœ„)
    uint256 usdtPerSecond,    // ì´ˆë‹¹ ìŠ¤íŠ¸ë¦¬ë° ì†ë„ (ë‹¬ëŸ¬ ë‹¨ìœ„)
    uint256 startTime,        // ì‹œì‘ ì‹œê°„ (Unix timestamp)
    uint256 stopTime,         // ì¢…ë£Œ ì‹œê°„ (Unix timestamp)
    uint256 remainingUSDT,    // ë‚¨ì€ ìŠ¤íŠ¸ë¦¬ë° ê¸ˆì•¡ (ë‹¬ëŸ¬ ë‹¨ìœ„)
    uint256 withdrawnUSDT,    // ì´ë¯¸ ì¶œê¸ˆëœ ê¸ˆì•¡ (ë‹¬ëŸ¬ ë‹¨ìœ„)
    bool isActive             // ìŠ¤íŠ¸ë¦¼ í™œì„± ìƒíƒœ
)
```

#### ì¼ë°˜ ìŠ¤íŠ¸ë¦¼ ìƒì„¸ ì •ë³´ ì¡°íšŒ
```solidity
function getStream(uint256 streamId) external view returns (
    address sender,
    address receiver, 
    address token,
    uint256 deposit,          // wei ë‹¨ìœ„ (í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ ì œì™¸ëœ ìˆœ ê¸ˆì•¡)
    uint256 flowRate,         // wei per second
    uint256 startTime,
    uint256 stopTime,
    uint256 remainingBalance, // wei ë‹¨ìœ„
    uint256 withdrawnBalance, // wei ë‹¨ìœ„
    bool isActive
)
```

### 3. ì¶œê¸ˆ
*ì™œ ì¶œê¸ˆ ê¸°ëŠ¥ì´ í•„ìš”í•œê°€?* ìŠ¤íŠ¸ë¦¬ë°ëœ ê¸ˆì•¡ì„ ì‹¤ì œ ì§€ê°‘ìœ¼ë¡œ ì´ë™í•˜ì—¬ ì‚¬ìš© ê°€ëŠ¥í•œ ìê¸ˆìœ¼ë¡œ ì „í™˜

```solidity
function withdrawFromStream(uint256 streamId) external nonReentrant
```
**ì„¤ëª…:**
- **ê¶Œí•œ**: `receiver`ë§Œ í˜¸ì¶œ ê°€ëŠ¥
- **ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡**: `balanceOf(streamId, receiver)` ê²°ê³¼ê°’
- **ìë™ ê³„ì‚°**: í˜„ì¬ ì‹œì ê¹Œì§€ ìŠ¤íŠ¸ë¦¬ë°ëœ ê¸ˆì•¡ì—ì„œ ì´ë¯¸ ì¶œê¸ˆí•œ ê¸ˆì•¡ì„ ì°¨ê°
- **ê°€ìŠ¤ íš¨ìœ¨ì„±**: ì¶œê¸ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡ì´ 0ì´ë©´ revert
- **ë³´ì•ˆ**: ReentrancyGuardë¡œ ì¬ì§„ì… ê³µê²© ë°©ì§€

**ì¶œê¸ˆ ê°€ëŠ¥ ì‹œì :**
- ìŠ¤íŠ¸ë¦¼ì´ í™œì„± ìƒíƒœì´ê³  (`isActive == true`)
- í˜„ì¬ ì‹œê°„ì´ ì‹œì‘ ì‹œê°„ ì´í›„ì´ë©° (`block.timestamp > startTime`)
- ìŠ¤íŠ¸ë¦¬ë°ëœ ê¸ˆì•¡ì´ ìˆëŠ” ê²½ìš°

**ì´ë²¤íŠ¸ ë°œìƒ:**
```solidity
event Withdrawal(uint256 indexed streamId, address indexed receiver, uint256 amount);
```

### 4. ìŠ¤íŠ¸ë¦¼ ì œì–´
*ì™œ ìŠ¤íŠ¸ë¦¼ ì œì–´ê°€ í•„ìš”í•œê°€?* ìƒí™© ë³€í™”ì— ë”°ë¥¸ ìœ ì—°í•œ ëŒ€ì‘ìœ¼ë¡œ ë¶„ìŸ ë°©ì§€ ë° ê³µì •í•œ ê±°ë˜ ë³´ì¥

#### ì¼ì‹œì •ì§€ (ì†¡ê¸ˆìë§Œ)
*ì™œ ì¼ì‹œì •ì§€ê°€ í•„ìš”í•œê°€?* í”„ë¡œì íŠ¸ ì§€ì—°, ì„±ê³¼ ë¯¸ë‹¬, ê¸´ê¸‰ìƒí™© ì‹œ ì¦‰ì‹œ ìŠ¤íŠ¸ë¦¼ ì¤‘ë‹¨ ê°€ëŠ¥
```solidity
function pauseStream(uint256 streamId) external
```
**ì„¤ëª…:**
- **ê¶Œí•œ**: `sender`ë§Œ í˜¸ì¶œ ê°€ëŠ¥
- **ì¡°ê±´**: ìŠ¤íŠ¸ë¦¼ì´ í™œì„± ìƒíƒœì—¬ì•¼ í•¨ (`isActive == true`)
- **íš¨ê³¼**: 
  - í˜„ì¬ ì‹œì ê¹Œì§€ì˜ ìŠ¤íŠ¸ë¦¬ë° ê¸ˆì•¡ì„ ê³„ì‚°í•˜ì—¬ `remainingBalance` ì—…ë°ì´íŠ¸
  - `stopTime`ì„ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ë³€ê²½
  - `isActive`ë¥¼ `false`ë¡œ ì„¤ì •
- **ì´ë²¤íŠ¸**: `StreamPaused(streamId, sender)`

#### ì¬ê°œ (ì†¡ê¸ˆìë§Œ)
*ì™œ ì¬ê°œê°€ í•„ìš”í•œê°€?* ë¬¸ì œ í•´ê²° í›„ ê¸°ì¡´ ì¡°ê±´ìœ¼ë¡œ ìŠ¤íŠ¸ë¦¼ì„ ë‹¤ì‹œ ì‹œì‘í•˜ì—¬ ì—…ë¬´ ì—°ì†ì„± ë³´ì¥
```solidity
function resumeStream(uint256 streamId, uint256 newStopTime) external
```
**ì„¤ëª…:**
- **ê¶Œí•œ**: `sender`ë§Œ í˜¸ì¶œ ê°€ëŠ¥
- **ì¡°ê±´**: ìŠ¤íŠ¸ë¦¼ì´ ë¹„í™œì„± ìƒíƒœì—¬ì•¼ í•¨ (`isActive == false`)
- **ë§¤ê°œë³€ìˆ˜**: `newStopTime`ì€ í˜„ì¬ ì‹œê°„ë³´ë‹¤ ë¯¸ë˜ì—¬ì•¼ í•¨
- **íš¨ê³¼**:
  - `stopTime`ì„ `newStopTime`ìœ¼ë¡œ ì—…ë°ì´íŠ¸
  - `isActive`ë¥¼ `true`ë¡œ ì„¤ì •
- **ì´ë²¤íŠ¸**: `StreamResumed(streamId, sender)`

#### ì·¨ì†Œ (ì†¡ê¸ˆì ë˜ëŠ” ìˆ˜ë ¹ì)  
*ì™œ ì·¨ì†Œê°€ í•„ìš”í•œê°€?* ê³„ì•½ íŒŒê¸° ì‹œì—ë„ ê³µì •í•œ ì •ì‚°ìœ¼ë¡œ ì–‘ì¸¡ ëª¨ë‘ í•©ë¦¬ì  ê²°ê³¼ ë³´ì¥
```solidity
function cancelStream(uint256 streamId) external nonReentrant
```
**ì„¤ëª…:**
- **ê¶Œí•œ**: `sender` ë˜ëŠ” `receiver` ëª¨ë‘ í˜¸ì¶œ ê°€ëŠ¥
- **ì”ì•¡ ë¶„ë°° ë¡œì§**:
  ```solidity
  // í™œì„± ìŠ¤íŠ¸ë¦¼ì´ê³  ì¢…ë£Œ ì‹œê°„ ì „ì¸ ê²½ìš°
  if (stream.isActive && block.timestamp < stream.stopTime) {
      uint256 elapsed = _calculateElapsedTime(streamId);
      uint256 streamed = elapsed * stream.flowRate;
      receiverBalance = streamed;
      senderBalance = stream.remainingBalance - streamed;
  } else {
      // ìì—° ì¢…ë£Œë˜ì—ˆê±°ë‚˜ ì¼ì‹œì •ì§€ëœ ê²½ìš°
      receiverBalance = stream.deposit - stream.remainingBalance;
      senderBalance = stream.remainingBalance;
  }
  ```
- **ìë™ ì „ì†¡**: ê³„ì‚°ëœ ì”ì•¡ì„ ê°ê° `receiver`ì™€ `sender`ì—ê²Œ ì „ì†¡
- **ì´ë²¤íŠ¸**: `StreamCanceled(streamId, sender, senderBalance, receiverBalance)`


## Flow Rate ê³„ì‚° ê³µì‹ ë° ìƒì„¸ ìŠ¤í™

### í•µì‹¬ ê³„ì‚° ê³µì‹

#### Flow Rate ê³„ì‚°
```javascript
// createStreamUSDTì˜ ê²½ìš°
const flowRate = deposit / durationInSeconds;

// createStreamì˜ ê²½ìš° (ì¼ë°˜)
const expectedFlowRate = deposit / (stopTime - startTime);
// ì œê³µëœ flowRateì™€ expectedFlowRateê°€ ì¼ì¹˜í•´ì•¼ í•¨
if (flowRate !== expectedFlowRate) {
    throw new Error('InvalidFlowRate');
}
```

#### ì‹¤ì‹œê°„ ì”ì•¡ ê³„ì‚°
```javascript
// ê²½ê³¼ ì‹œê°„ ê³„ì‚°
function calculateElapsedTime(stream, currentTime) {
    if (currentTime <= stream.startTime) return 0;
    
    const endTime = stream.isActive ? 
        Math.min(currentTime, stream.stopTime) : 
        stream.stopTime;
    
    return endTime - stream.startTime;
}

// ìŠ¤íŠ¸ë¦¬ë°ëœ ê¸ˆì•¡ ê³„ì‚°
function calculateStreamed(stream, currentTime) {
    const elapsed = calculateElapsedTime(stream, currentTime);
    const streamed = elapsed * stream.flowRate;
    return Math.min(streamed, stream.deposit);
}

// ìˆ˜ë ¹ì ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡
function getReceiverBalance(stream, currentTime) {
    const streamed = calculateStreamed(stream, currentTime);
    return Math.max(0, streamed - stream.withdrawnBalance);
}

// ì†¡ê¸ˆì ì”ì—¬ ê¸ˆì•¡
function getSenderBalance(stream, currentTime) {
    const streamed = calculateStreamed(stream, currentTime);
    return stream.deposit - streamed;
}
```

### ë°ì´í„° êµ¬ì¡° ìƒì„¸ ìŠ¤í™

#### Stream êµ¬ì¡°ì²´
```solidity
struct Stream {
    address sender;           // ì†¡ê¸ˆì ì£¼ì†Œ
    address receiver;         // ìˆ˜ë ¹ì ì£¼ì†Œ
    address token;            // ERC20 í† í° ì£¼ì†Œ
    uint256 deposit;          // ì´ ìŠ¤íŠ¸ë¦¬ë° ê¸ˆì•¡
    uint256 flowRate;         // wei per second
    uint256 startTime;        // Unix timestamp
    uint256 stopTime;         // Unix timestamp
    uint256 remainingBalance; // ë‚¨ì€ ì”ì•¡ (pauseStreamì‹œ ì—…ë°ì´íŠ¸)
    uint256 withdrawnBalance; // ì´ë¯¸ ì¶œê¸ˆëœ ê¸ˆì•¡
    bool isActive;            // ìŠ¤íŠ¸ë¦¼ í™œì„± ìƒíƒœ
}
```

#### ë§¤í•‘ êµ¬ì¡°
```solidity
mapping(uint256 => Stream) public streams;           // streamId => Stream
mapping(address => uint256[]) public senderStreams;   // sender => streamIds[]
mapping(address => uint256[]) public receiverStreams; // receiver => streamIds[]
```

#### ìƒìˆ˜ ë° ë³€ìˆ˜
```solidity
uint256 public nextStreamId = 1;                    // ë‹¤ìŒ ìŠ¤íŠ¸ë¦¼ ID
```

### ì´ë²¤íŠ¸ ìŠ¤í™

```solidity
// ìŠ¤íŠ¸ë¦¼ ìƒì„± ì‹œ
event StreamCreated(
    uint256 indexed streamId,
    address indexed sender,
    address indexed receiver,
    address token,
    uint256 deposit,          // ì‚¬ìš©ìê°€ ì‹¤ì œ ì˜ˆì¹˜í•œ ì´ ê¸ˆì•¡
    uint256 flowRate,
    uint256 startTime,
    uint256 stopTime
);

// ìŠ¤íŠ¸ë¦¼ ì¼ì‹œì •ì§€ ì‹œ
event StreamPaused(uint256 indexed streamId, address indexed sender);

// ìŠ¤íŠ¸ë¦¼ ì¬ê°œ ì‹œ  
event StreamResumed(uint256 indexed streamId, address indexed sender);

// ìŠ¤íŠ¸ë¦¼ ì·¨ì†Œ ì‹œ
event StreamCanceled(
    uint256 indexed streamId, 
    address indexed sender, 
    uint256 senderBalance,    // ì†¡ê¸ˆìì—ê²Œ ë°˜í™˜ëœ ê¸ˆì•¡
    uint256 receiverBalance   // ìˆ˜ë ¹ìì—ê²Œ ì „ì†¡ëœ ê¸ˆì•¡
);

// ì¶œê¸ˆ ì‹œ
event Withdrawal(uint256 indexed streamId, address indexed receiver, uint256 amount, uint256 timestamp);
```

### ì—ëŸ¬ ì²˜ë¦¬

```solidity
error StreamNotFound();      // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìŠ¤íŠ¸ë¦¼ ID
error NotAuthorized();       // ê¶Œí•œ ì—†ìŒ (sender/receiver ì•„ë‹˜)
error StreamNotActive();     // ìŠ¤íŠ¸ë¦¼ì´ ë¹„í™œì„± ìƒíƒœ
error InvalidStreamParams(); // ì˜ëª»ëœ ë§¤ê°œë³€ìˆ˜ (0 ì£¼ì†Œ, ì‹œê°„ ë“±)
error InsufficientDeposit(); // ì˜ˆì¹˜ê¸ˆ ë¶€ì¡±
error WithdrawFailed();      // ì¶œê¸ˆ ì‹¤íŒ¨ (ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡ 0)
error InvalidFlowRate();     // ì˜ëª»ëœ flow rate (ê³„ì‚°ê°’ê³¼ ë¶ˆì¼ì¹˜)
```

## ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### 1. USDT ì›”ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ğŸ’¼

```javascript
// $3,000 ì›”ê¸‰ì„ 30ì¼ê°„ ì‹¤ì‹œê°„ ì§€ê¸‰
const streamId = await moneyStreaming.createStreamUSDT(
    employeeAddress,      // ì§ì› ì§€ê°‘ ì£¼ì†Œ
    usdtTokenAddress,     // Kaiaì˜ USDT í† í° ì£¼ì†Œ
    3000,                 // $3,000
    30 * 24 * 3600        // 30ì¼ (ì´ˆ ë‹¨ìœ„)
);

// 1ì£¼ì¼ í›„ ì¶œê¸ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡ í™•ì¸
const weeklyEarnings = await moneyStreaming.getUSDTBalance(streamId, employeeAddress);
console.log(`1ì£¼ì¼ í›„ ì¶œê¸ˆ ê°€ëŠ¥: $${weeklyEarnings}`); // ì•½ $700
```

### 2. í”„ë¡œì íŠ¸ ê³„ì•½ê¸ˆ ìŠ¤íŠ¸ë¦¬ë° ğŸš€

```javascript
// $50,000 í”„ë¡œì íŠ¸ë¥¼ 90ì¼ê°„ ìŠ¤íŠ¸ë¦¬ë°
const projectStreamId = await moneyStreaming.createStreamUSDTWithDetails(
    freelancerAddress,    // í”„ë¦¬ëœì„œ ì£¼ì†Œ
    usdtTokenAddress,     // USDT í† í° ì£¼ì†Œ
    50000,                // $50,000
    startTimestamp,       // í”„ë¡œì íŠ¸ ì‹œì‘ì¼
    endTimestamp          // í”„ë¡œì íŠ¸ ì¢…ë£Œì¼ (90ì¼ í›„)
);

// 30ì¼ í›„ (1/3 ì§„í–‰) ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡
const progressPayment = await moneyStreaming.getUSDTBalance(projectStreamId, freelancerAddress);
console.log(`30ì¼ ì§„í–‰ í›„: $${progressPayment}`); // ì•½ $16,667
```

### 3. êµ¬ë… ì„œë¹„ìŠ¤ ê²°ì œ ğŸ“±

```javascript
// ì›” $29.99 êµ¬ë… ì„œë¹„ìŠ¤
const subscriptionId = await moneyStreaming.createStreamUSDT(
    serviceProviderAddress, // ì„œë¹„ìŠ¤ ì œê³µì ì£¼ì†Œ
    usdtTokenAddress,       // USDT í† í° ì£¼ì†Œ
    30,                     // $29.99 (ë°˜ì˜¬ë¦¼)
    30 * 24 * 3600         // 30ì¼
);

// ì–¸ì œë“  êµ¬ë… ì·¨ì†Œ ê°€ëŠ¥
await moneyStreaming.cancelStream(subscriptionId);
```


## í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### ê¸°ë³¸ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ (MoneyStreaming.t.sol)
- âœ… ìŠ¤íŠ¸ë¦¼ ìƒì„± ë° ê²€ì¦
- âœ… ì‹¤ì‹œê°„ ì”ì•¡ ê³„ì‚°
- âœ… ì¶œê¸ˆ ê¸°ëŠ¥
- âœ… ì¼ì‹œì •ì§€/ì¬ê°œ/ì·¨ì†Œ
- âœ… ê¶Œí•œ ë° ì˜¤ë¥˜ ì²˜ë¦¬
- âœ… Flow rate ê²€ì¦

### USDT íŠ¹í™” í…ŒìŠ¤íŠ¸ (MoneyStreamingUSDT.t.sol)
- âœ… USDT ìŠ¤íŠ¸ë¦¼ ìƒì„± (ë‘ ê°€ì§€ ë°©ë²•)
- âœ… 6-decimal ì •ë°€ë„ ì²˜ë¦¬
- âœ… ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ (ì›”ê¸‰, í”„ë¡œì íŠ¸)
- âœ… ë‹¬ëŸ¬ ë‹¨ìœ„ ì”ì•¡ ì¡°íšŒ
- âœ… ì†Œì•¡ ìŠ¤íŠ¸ë¦¬ë° ì •í™•ì„±

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê²°ê³¼
```bash
forge test --gas-report
# âœ… 20ê°œ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼
# âœ… ê°€ìŠ¤ íš¨ìœ¨ì„± ê²€ì¦ ì™„ë£Œ
# âœ… ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦ ì™„ë£Œ
```

### USDTMock ê¸°ë°˜ í…ŒìŠ¤íŠ¸ì˜ ì¥ì 
*ì™œ USDTMockì„ ì‚¬ìš©í•˜ë‚˜?*
- **ë¹„ìš© ì ˆì•½**: ì‹¤ì œ USDT í† í° êµ¬ë§¤ ì—†ì´ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- **ì™„ì „í•œ ì œì–´**: í•„ìš”í•œ ë§Œí¼ í† í° ë°œí–‰/ì†Œê°ìœ¼ë¡œ ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- **ì‹¤ì œ í™˜ê²½ ëª¨ì‚¬**: 6 decimals êµ¬ì¡°ë¡œ í”„ë¡œë•ì…˜ í™˜ê²½ê³¼ ë™ì¼í•œ ì¡°ê±´ í…ŒìŠ¤íŠ¸
- **ê°œë°œ íš¨ìœ¨ì„±**: ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ê°€ëŠ¥

## ë°°í¬ ê°€ì´ë“œ

### Kaia í…ŒìŠ¤íŠ¸ë„· ë°°í¬
```bash
# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
export PRIVATE_KEY="your_private_key"
export KAIA_RPC_URL="https://public-en.kairos.node.kaia.io"
export FEE_COLLECTOR="0x..." # ìˆ˜ìˆ˜ë£Œ ìˆ˜ì§‘ì ì£¼ì†Œ

# ë°°í¬ ì‹¤í–‰
forge script script/DeployMoneyStreaming.s.sol:DeployMoneyStreamingScript \
    --rpc-url $KAIA_RPC_URL \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --verify
```

### Kaia ë©”ì¸ë„· ë°°í¬
```bash
# ë©”ì¸ë„· RPC URLë¡œ ë³€ê²½
export KAIA_RPC_URL="https://public-en.cypress.node.kaia.io"

# ë™ì¼í•œ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©
forge script script/DeployMoneyStreaming.s.sol:DeployMoneyStreamingScript \
    --rpc-url $KAIA_RPC_URL \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --verify
```

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ğŸ”’ êµ¬í˜„ëœ ë³´ì•ˆ ê¸°ëŠ¥
- **ReentrancyGuard**: ì¬ì§„ì… ê³µê²© ì°¨ë‹¨
- **Ownable**: ê´€ë¦¬ì ê¶Œí•œ ë³´í˜¸
- **Input Validation**: ëª¨ë“  ì…ë ¥ê°’ ê²€ì¦
- **SafeERC20**: ì•ˆì „í•œ í† í° ì „ì†¡
- **Flow Rate Validation**: ì •í™•í•œ ìŠ¤íŠ¸ë¦¬ë° ë¹„ìœ¨ ê²€ì¦

### âš ï¸ ì£¼ì˜ì‚¬í•­
- ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ëŠ” ìˆ˜ì • ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ë°°í¬ ì „ ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ í•„ìš”
- USDT í† í° ì£¼ì†ŒëŠ” ê³µì‹ ì£¼ì†Œë¥¼ ì‚¬ìš©í•´ì•¼ í•¨
- ì†Œì•¡ ìŠ¤íŠ¸ë¦¬ë° ì‹œ ì •ë°€ë„ ì†ì‹¤ ê°€ëŠ¥ì„± ìˆìŒ

## ê°€ìŠ¤ ìµœì í™”

### íš¨ìœ¨ì ì¸ ì‚¬ìš©ë²•
- **ë°°ì¹˜ ì •ì‚°**: ì—¬ëŸ¬ ì¶œê¸ˆì„ í•œ ë²ˆì— ì²˜ë¦¬
- **ì ì ˆí•œ ìŠ¤íŠ¸ë¦¼ ê¸°ê°„**: ë„ˆë¬´ ì§§ì€ ìŠ¤íŠ¸ë¦¼ì€ ê°€ìŠ¤ë¹„ ëŒ€ë¹„ ë¹„íš¨ìœ¨
- **ì˜¤í”„ì²´ì¸ ëª¨ë‹ˆí„°ë§**: ì”ì•¡ ì¡°íšŒëŠ” ì˜¤í”„ì²´ì¸ì—ì„œ ì²˜ë¦¬

### ê°€ìŠ¤ ë¹„ìš© (í…ŒìŠ¤íŠ¸ë„· ê¸°ì¤€)
- ìŠ¤íŠ¸ë¦¼ ìƒì„±: ~387,000 gas
- ì¶œê¸ˆ: ~98,900 gas
- ì¼ì‹œì •ì§€: ~40,300 gas
- ì·¨ì†Œ: ~76,500 gas

## í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ í†µí•© ê°€ì´ë“œ

### ì›¹3 ì—°ë™ì„ ìœ„í•œ JavaScript ì˜ˆì œ

#### 1. ì»¨íŠ¸ë™íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
```javascript
import { ethers } from 'ethers';

const MONEY_STREAMING_ABI = [
  // ABIëŠ” forge out/MoneyStreaming.sol/MoneyStreaming.jsonì—ì„œ í™•ì¸
];

const provider = new ethers.providers.JsonRpcProvider('https://public-en.cypress.node.kaia.io');
const signer = provider.getSigner();
const moneyStreaming = new ethers.Contract(CONTRACT_ADDRESS, MONEY_STREAMING_ABI, signer);
```

#### 2. USDT ìŠ¤íŠ¸ë¦¼ ìƒì„± (ì¶”ì²œ)
```javascript
async function createUSDTStream(receiverAddress, usdtAmount, durationDays) {
  try {
    // USDT í† í° ìŠ¹ì¸ (ì‚¬ì „ í•„ìš”)
    const usdtContract = new ethers.Contract(USDT_TOKEN_ADDRESS, ERC20_ABI, signer);
    
    // í•„ìš”í•œ ì´ ì˜ˆì¹˜ê¸ˆ ê³„ì‚°
    const totalDeposit = ethers.utils.parseUnits(usdtAmount.toString(), 6); // USDTëŠ” 6 decimals
    
    // USDT ìŠ¹ì¸
    const approveTx = await usdtContract.approve(CONTRACT_ADDRESS, totalDeposit);
    await approveTx.wait();
    
    // ìŠ¤íŠ¸ë¦¼ ìƒì„±
    const durationSeconds = durationDays * 24 * 3600;
    const tx = await moneyStreaming.createStreamUSDT(
      receiverAddress,
      USDT_TOKEN_ADDRESS,
      usdtAmount, // decimals ì œì™¸í•œ ìˆœìˆ˜ ë‹¬ëŸ¬ ê¸ˆì•¡
      durationSeconds
    );
    
    const receipt = await tx.wait();
    const streamId = receipt.events.find(e => e.event === 'StreamCreated').args.streamId;
    
    return {
      success: true,
      streamId: streamId.toString(),
      txHash: receipt.transactionHash
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
```

#### 3. ì‹¤ì‹œê°„ ì”ì•¡ ëª¨ë‹ˆí„°ë§
```javascript
async function getStreamBalance(streamId, accountAddress) {
  try {
    // USDT ì”ì•¡ ì¡°íšŒ (ë‹¬ëŸ¬ ë‹¨ìœ„)
    const usdtBalance = await moneyStreaming.getUSDTBalance(streamId, accountAddress);
    
    // ìƒì„¸ ì •ë³´ ì¡°íšŒ
    const streamInfo = await moneyStreaming.getUSDTStreamInfo(streamId);
    
    return {
      availableUSDT: usdtBalance.toString(),
      streamInfo: {
        sender: streamInfo[0],
        receiver: streamInfo[1],
        totalAmount: streamInfo[3].toString(),
        usdtPerSecond: streamInfo[4].toString(),
        startTime: streamInfo[5].toString(),
        stopTime: streamInfo[6].toString(),
        remainingUSDT: streamInfo[7].toString(),
        withdrawnUSDT: streamInfo[8].toString(),
        isActive: streamInfo[9]
      }
    };
  } catch (error) {
    console.error('Balance query failed:', error);
    return null;
  }
}
```

#### 4. ì¶œê¸ˆ ê¸°ëŠ¥ êµ¬í˜„
```javascript
async function withdrawFromStream(streamId) {
  try {
    // ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡ í™•ì¸
    const balance = await moneyStreaming.getUSDTBalance(streamId, userAddress);
    if (balance.eq(0)) {
      throw new Error('ì¶œê¸ˆ ê°€ëŠ¥í•œ ê¸ˆì•¡ì´ ì—†ìŠµë‹ˆë‹¤');
    }
    
    // ì¶œê¸ˆ ì‹¤í–‰
    const tx = await moneyStreaming.withdrawFromStream(streamId);
    const receipt = await tx.wait();
    
    const withdrawEvent = receipt.events.find(e => e.event === 'Withdrawal');
    const withdrawnAmount = withdrawEvent.args.amount;
    const withdrawTimestamp = withdrawEvent.args.timestamp;
    
    return {
      success: true,
      withdrawnUSDT: ethers.utils.formatUnits(withdrawnAmount, 6),
      timestamp: withdrawTimestamp.toString(),
      withdrawTime: new Date(withdrawTimestamp * 1000).toISOString(),
      txHash: receipt.transactionHash
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
```

### ë°±ì—”ë“œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

#### ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ êµ¬í˜„
```javascript
const express = require('express');
const { ethers } = require('ethers');
const app = express();

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë‹ ì„¤ì •
function setupEventListeners() {
  // ìŠ¤íŠ¸ë¦¼ ìƒì„± ì´ë²¤íŠ¸
  moneyStreaming.on('StreamCreated', async (streamId, sender, receiver, token, deposit, flowRate, startTime, stopTime) => {
    console.log('New stream created:', {
      streamId: streamId.toString(),
      sender,
      receiver,
      depositUSDT: ethers.utils.formatUnits(deposit, 6)
    });
    
    // ë°ì´í„°ë² ì´ìŠ¤ì— ìŠ¤íŠ¸ë¦¼ ì •ë³´ ì €ì¥
    await saveStreamToDatabase({
      streamId: streamId.toString(),
      sender,
      receiver,
      token,
      deposit: deposit.toString(),
      flowRate: flowRate.toString(),
      startTime: startTime.toString(),
      stopTime: stopTime.toString()
    });
  });
  
  // ì¶œê¸ˆ ì´ë²¤íŠ¸
  moneyStreaming.on('Withdrawal', async (streamId, receiver, amount, timestamp) => {
    console.log('Withdrawal occurred:', {
      streamId: streamId.toString(),
      receiver,
      amountUSDT: ethers.utils.formatUnits(amount, 6),
      timestamp: new Date(timestamp * 1000).toISOString()
    });
    
    // ì•Œë¦¼ ë°œì†¡
    await sendNotification(receiver, {
      type: 'withdrawal',
      streamId: streamId.toString(),
      amount: ethers.utils.formatUnits(amount, 6),
      timestamp: timestamp.toString()
    });
  });
}
```

### REST API ì„¤ê³„ ì˜ˆì‹œ

```javascript
// GET /api/streams/:address - ì‚¬ìš©ìì˜ ëª¨ë“  ìŠ¤íŠ¸ë¦¼ ì¡°íšŒ
app.get('/api/streams/:address', async (req, res) => {
  try {
    const address = req.params.address;
    
    // ì†¡ê¸ˆìë¡œì„œì˜ ìŠ¤íŠ¸ë¦¼ë“¤
    const senderStreams = await moneyStreaming.getSenderStreams(address);
    
    // ìˆ˜ë ¹ìë¡œì„œì˜ ìŠ¤íŠ¸ë¦¼ë“¤
    const receiverStreams = await moneyStreaming.getReceiverStreams(address);
    
    const allStreams = [];
    
    // ê° ìŠ¤íŠ¸ë¦¼ì˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ
    for (const streamId of [...senderStreams, ...receiverStreams]) {
      const streamInfo = await moneyStreaming.getUSDTStreamInfo(streamId);
      const balance = await moneyStreaming.getUSDTBalance(streamId, address);
      
      allStreams.push({
        streamId: streamId.toString(),
        role: senderStreams.includes(streamId) ? 'sender' : 'receiver',
        ...streamInfo,
        currentBalance: balance.toString()
      });
    }
    
    res.json({ success: true, streams: allStreams });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});

// POST /api/streams - ìƒˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±
app.post('/api/streams', async (req, res) => {
  try {
    const { receiver, usdtAmount, durationDays, senderAddress } = req.body;
    
    // í•„ìš”í•œ ìŠ¹ì¸ ê¸ˆì•¡ ê³„ì‚°
    const requiredAllowance = ethers.utils.parseUnits(usdtAmount.toString(), 6);
    
    res.json({
      success: true,
      requiredAllowance: ethers.utils.formatUnits(requiredAllowance, 6),
      netAmount: usdtAmount
    });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});
```

### ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ì²˜ë¦¬

```javascript
// ì—ëŸ¬ ë©”ì‹œì§€ ë§¤í•‘
const ERROR_MESSAGES = {
  'StreamNotFound': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ìŠ¤íŠ¸ë¦¼ì…ë‹ˆë‹¤.',
  'NotAuthorized': 'ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.',
  'StreamNotActive': 'ìŠ¤íŠ¸ë¦¼ì´ ë¹„í™œì„± ìƒíƒœì…ë‹ˆë‹¤.',
  'InvalidStreamParams': 'ì˜ëª»ëœ ë§¤ê°œë³€ìˆ˜ì…ë‹ˆë‹¤.',
  'InsufficientDeposit': 'ì˜ˆì¹˜ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤.',
  'WithdrawFailed': 'ì¶œê¸ˆí•  ìˆ˜ ìˆëŠ” ê¸ˆì•¡ì´ ì—†ìŠµë‹ˆë‹¤.',
  'InvalidFlowRate': 'Flow rateê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'
};

function handleContractError(error) {
  const errorName = error.reason || error.message;
  return ERROR_MESSAGES[errorName] || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
}
```

## í–¥í›„ ê°œë°œ ê³„íš

### ğŸš€ Phase 2 ê¸°ëŠ¥
- **ë‹¤ì¤‘ í† í° ì§€ì›**: ETH, KLAY, ê¸°íƒ€ ERC20 í† í°
- **ìë™ ì¬íˆ¬ì**: ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ í›„ ìë™ìœ¼ë¡œ ìƒˆ ìŠ¤íŠ¸ë¦¼ ìƒì„±
- **ì¡°ê±´ë¶€ ìŠ¤íŠ¸ë¦¼**: íŠ¹ì • ì¡°ê±´ ë§Œì¡± ì‹œì—ë§Œ ì‹¤í–‰ë˜ëŠ” ìŠ¤íŠ¸ë¦¼

### ğŸŒŸ Phase 3 ê¸°ëŠ¥
- **DAO ê±°ë²„ë„ŒìŠ¤**: í”Œë«í¼ ìˆ˜ìˆ˜ë£Œ ë° ì •ì±…ì˜ íƒˆì¤‘ì•™í™” ê²°ì •
- **ìŠ¤í…Œì´í‚¹ ë¦¬ì›Œë“œ**: í”Œë«í¼ í† í° ê¸°ë°˜ ì¸ì„¼í‹°ë¸Œ ì‹œìŠ¤í…œ
- **í¬ë¡œìŠ¤ì²´ì¸ ë¸Œë¦¿ì§€**: ë‹¤ë¥¸ ë¸”ë¡ì²´ì¸ê³¼ì˜ ì—°ë™

## ê°€ìŠ¤ ìµœì í™” ë° ì„±ëŠ¥ ê°€ì´ë“œ

### ê°€ìŠ¤ ì‚¬ìš©ëŸ‰ ë¶„ì„ (ì‹¤ì œ ì¸¡ì •ê°’)

```bash
# ê°€ìŠ¤ ë¦¬í¬íŠ¸ ìƒì„±
forge test --gas-report

# ê²°ê³¼ ì˜ˆì‹œ:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ Contract            â”‚ Method          â”‚ Min  â”‚ Max    â”‚ Avg  â”‚ # calls â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ MoneyStreaming      â”‚ createStreamUSDTâ”‚380000â”‚ 410000 â”‚387000â”‚    5    â”‚
# â”‚ MoneyStreaming      â”‚ withdrawFromStreamâ”‚95000â”‚105000 â”‚ 98900â”‚   10    â”‚
# â”‚ MoneyStreaming      â”‚ pauseStream     â”‚35000â”‚ 45000 â”‚ 40300â”‚    3    â”‚
# â”‚ MoneyStreaming      â”‚ cancelStream    â”‚70000â”‚ 85000 â”‚ 76500â”‚    4    â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê°€ìŠ¤ ìµœì í™” íŒ

#### 1. ë°°ì¹˜ ì²˜ë¦¬ë¡œ ê°€ìŠ¤ ì ˆì•½
```javascript
// ë¹„íš¨ìœ¨ì : ê°œë³„ ì¶œê¸ˆ
for (const streamId of streamIds) {
  await moneyStreaming.withdrawFromStream(streamId);
}

// íš¨ìœ¨ì : ë°°ì¹˜ ì¶œê¸ˆ (í–¥í›„ êµ¬í˜„ ì˜ˆì •)
await moneyStreaming.batchWithdraw(streamIds);
```

#### 2. ì ì ˆí•œ ìŠ¤íŠ¸ë¦¼ ê¸°ê°„ ì„¤ì •
```javascript
// ë¹„íš¨ìœ¨ì : ë„ˆë¬´ ì§§ì€ ìŠ¤íŠ¸ë¦¼ (ê°€ìŠ¤ë¹„ > ìŠ¤íŠ¸ë¦¬ë° ê¸ˆì•¡)
const tooShort = await createUSDTStream(receiver, 10, 1); // $10, 1ì¼

// íš¨ìœ¨ì : ì ì ˆí•œ ê¸°ê°„ ì„¤ì •
const optimal = await createUSDTStream(receiver, 1000, 30); // $1000, 30ì¼
```

#### 3. ì˜¤í”„ì²´ì¸ ëª¨ë‹ˆí„°ë§ í™œìš©
```javascript
// ê°€ìŠ¤ ì†Œëª¨ ì—†ëŠ” ì”ì•¡ ì¡°íšŒ
const balance = await moneyStreaming.getUSDTBalance(streamId, address);

// ê°€ìŠ¤ ì†Œëª¨ ì—†ëŠ” ìŠ¤íŠ¸ë¦¼ ì •ë³´ ì¡°íšŒ
const streamInfo = await moneyStreaming.getUSDTStreamInfo(streamId);
```

### ë„¤íŠ¸ì›Œí¬ë³„ ê°€ìŠ¤ë¹„ ì¶”ì • (2024ë…„ ê¸°ì¤€)

#### Kaia ë©”ì¸ë„·
- ê¸°ë³¸ ê°€ìŠ¤ ê°€ê²©: 25 Gwei
- ìŠ¤íŠ¸ë¦¼ ìƒì„±: ~$2-3
- ì¶œê¸ˆ: ~$0.5-1
- ì¼ì‹œì •ì§€/ì¬ê°œ: ~$0.2-0.5

#### Kaia í…ŒìŠ¤íŠ¸ë„· (Kairos)
- ê¸°ë³¸ ê°€ìŠ¤ ê°€ê²©: 25 Gwei  
- ëª¨ë“  ì‘ì—…: ë¬´ë£Œ (í…ŒìŠ¤íŠ¸ ëª©ì )

### ì‹¤ì‹œê°„ ê°€ìŠ¤ ì¶”ì 
```javascript
// íŠ¸ëœì­ì…˜ ê°€ìŠ¤ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
async function executeWithGasTracking(contractMethod, ...args) {
  const gasEstimate = await contractMethod.estimateGas(...args);
  console.log(`ì˜ˆìƒ ê°€ìŠ¤ ì‚¬ìš©ëŸ‰: ${gasEstimate.toString()}`);
  
  const tx = await contractMethod(...args);
  const receipt = await tx.wait();
  
  console.log(`ì‹¤ì œ ê°€ìŠ¤ ì‚¬ìš©ëŸ‰: ${receipt.gasUsed.toString()}`);
  console.log(`ê°€ìŠ¤ ê°€ê²©: ${tx.gasPrice.toString()} Gwei`);
  
  return receipt;
}
```

## Foundry ê°œë°œ ë„êµ¬

### ê¸°ë³¸ ëª…ë ¹ì–´
```bash
# ë¹Œë“œ
forge build

# í…ŒìŠ¤íŠ¸
forge test

# í¬ë§·íŒ…
forge fmt

# ê°€ìŠ¤ ìŠ¤ëƒ…ìƒ·
forge snapshot

# ë¡œì»¬ ë…¸ë“œ ì‹¤í–‰
anvil

# ì»¨íŠ¸ë™íŠ¸ ë°°í¬
forge script script/DeployMoneyStreaming.s.sol:DeployMoneyStreamingScript \
    --rpc-url <your_rpc_url> --private-key <your_private_key>

# Cast ë„êµ¬ ì‚¬ìš©
cast <subcommand>

# ë„ì›€ë§
forge --help
anvil --help
cast --help
```

## ë¼ì´ì„¼ìŠ¤

MIT License

## ì§€ì› ë° ë¬¸ì˜

- **GitHub Issues**: ë²„ê·¸ ë¦¬í¬íŠ¸ ë° ê¸°ëŠ¥ ì œì•ˆ
- **Documentation**: ìƒì„¸í•œ ê¸°ìˆ  ë¬¸ì„œëŠ” `/docs` í´ë” ì°¸ì¡°
- **Community**: Kaia ì»¤ë®¤ë‹ˆí‹° Discord ì±„ë„

---

> **ğŸ¯ Kaia Native USDT ë¨¸ë‹ˆ ìŠ¤íŠ¸ë¦¬ë° í”„ë¡œí† ì½œ**  
> ì‹¤ì‹œê°„ ê²°ì œì˜ ìƒˆë¡œìš´ íŒ¨ëŸ¬ë‹¤ì„ì„ ì œì‹œí•©ë‹ˆë‹¤.
